#####################################
## 확률과 통계 과제                ##
## 고려대학교                      ##
## 서민석                          ##
## 2021270678 나강민 전체질문 대답 ##
#####################################

## 라이브러리 및 저장소 설정
setRepositories(ind = 1:7)

# 패키지 설치
# install.packages("BSDA")
#install.packages("devtools")


## 라이브러리 불러오기
library(devtools)
library(BSDA)

# 데이터 불러오기
data <- read.table("/Users/mac_nkm/Documents/GitHub/Probability_Statistics_KUS/HomeWork2/Data.txt", header = TRUE, sep = "\t", stringsAsFactors = FALSE) 

# 코로나에 걸린 사람의 데이터 분리
data_infected <- subset(data, Disease == "COVID19")  

# z-test 수행
mu0 <- 128.65  # 국립보건원에서 정한 정상인의 수축기 혈압 평균
sigma <- 16.5  # 국립보건원에서 정한 정상인의 수축기 혈압 표준편차
n <- nrow(data_infected)  # 코로나에 걸린 사람의 수
xbar <- mean(data_infected$sysBP)  # 코로나에 걸린 사람들의 수축기 혈압 평균
se <- sigma / sqrt(n)  # 표준 오차
z <- (xbar - mu0) / se  # 검정 통계량 계산

# p-value 계산
p_value <- 2 * pnorm(-abs(z))

# 결과 출력
cat("검정 통계량:", z, "
")
cat("p-value:", p_value, "
")

# 5% 유의 수준에서 의사결정
if (p_value < 0.05) {
  cat("5%의 유의 수준에서, 귀무 가설을 기각하고 대립 가설을 선택합니다. 즉, 코로나에 걸린 사람들의 수축기 혈압이 정상인의 혈압과 통계적으로 유의미하게 다릅니다.
")
} else {
  cat("5%의 유의 수준에서, 귀무 가설을 기각하지 않습니다. 즉, 코로나에 걸린 사람들의 수축기 혈압이 정상인의 혈압과 통계적으로 유의미한 차이가 없습니다.
")
}

############ 해당 코드 설명 ###################

# 귀무 가설(H0): 코로나에 걸린 사람들의 수축기 혈압이 정상인의 혈압과 같다. ("Collected Samples are not biased")
# 대립 가설(H1): 코로나에 걸린 사람들의 수축기 혈압이 정상인의 혈압과 다르다. ("The sample collected will be different from the population")

# 만약 p-value가 0.05보다 작다면, 5%의 유의 수준에서 귀무 가설을 기각하고 대립 가설을 선택합니다. 
# 이는 코로나에 걸린 사람들의 수축기 혈압이 정상인의 혈압과 통계적으로 유의미하게 다르다는 것을 의미합니다.

# 반대로, p-value가 0.05보다 크다면, 5%의 유의 수준에서 귀무 가설을 기각하지 않습니다. 
# 이는 코로나에 걸린 사람들의 수축기 혈압이 정상인의 혈압과 통계적으로 유의미한 차이가 없다는 것을 의미합니다.

# 검정 통계량이 약 3.38이고 p-value는 약 0.00073입니다. 유의 수준은 5%(0.05)로 설정되었습니다.

# p-value가 유의 수준 0.05보다 작으므로, 귀무 가설을 기각하고 대립 가설을 선택합니다. 이는 '코로나에 걸린 사람들의 수축기 혈압이 정상인의 혈압과 통계적으로 유의미하게 다르다'는 결론을 내리게 됩니다.

# 즉, 이 결과는 코로나에 걸린 사람들의 수축기 혈압이 정상인의 혈압과 크게 다르다는 것을 의미합니다. 이는 귀무 가설을 기각하였기 때문에, 코로나에 걸린 사람들의 수축기 혈압이 정상인의 혈압과 통계적으로 유의미한 차이가 있다는 점을 기반으로 합니다.

# 따라서, 통계적으로 깔끔하게 올바른 결론은 '수집된 샘플은 편향되어 있으며, 코로나에 걸린 사람들의 수축기 혈압은 정상인의 혈압과 다르다'라고 할 수 있습니다. 이는 5%의 유의 수준에서 귀무 가설을 기각하고 대립 가설을 선택한 결과입니다.

##################################
## 확률과 통계 과제             ##
## 고려대학교                   ##
## 서민석                       ##
## 2021270678 나강민 질문2      ##
##################################

# 코로나에 걸린 사람의 데이터 분리
data_infected <- subset(data, Disease == "COVID19") 

# z-test 수행
mu0 <- 128.65  # 국립보건원에서 정한 정상인의 수축기 혈압 평균
sigma <- 16.5  # 국립보건원에서 정한 정상인의 수축기 혈압 표준편차
n <- nrow(data_infected)  # 코로나에 걸린 사람의 수
xbar <- mean(data_infected$sysBP)  # 코로나에 걸린 사람들의 수축기 혈압 평균
se <- sigma / sqrt(n)  # 표준 오차
z <- (xbar - mu0) / se  # 검정 통계량 계산

# p-value 계산
p_value <- pnorm(-abs(z))  # 단측 검정을 수행하므로, pnorm 함수에 -abs(z)를 넣습니다.

# 결과 출력
cat("검정 통계량:", z, "
")
cat("p-value:", p_value, "
")

# 5% 유의 수준에서 의사결정
if (p_value < 0.05) {
  cat("5%의 유의 수준에서, 귀무 가설을 기각하고 대립 가설을 선택합니다. 즉, 코로나에 걸린 사람들의 수축기 혈압이 정상인의 혈압보다 통계적으로 유의미하게 높습니다.
")
} else {
  cat("5%의 유의 수준에서, 귀무 가설을 기각하지 않습니다. 즉, 코로나에 걸린 사람들의 수축기 혈압이 정상인의 혈압보다 통계적으로 유의미하게 높다고 할 수 없습니다.
")
}

############ 해당 코드 설명 ###################


# 이 문제에서는 코로나19 환자가 알려진 국가 통계보다 높은 수축기 혈압을 보이는지에 대해 통계적으로 검정하려고 합니다. 5% 유의 수준에서 이를 검증해봅시다.

# (1) 대립 가설(H1): 코로나19 환자의 수축기 혈압은 알려진 국가 통계보다 높다.

# (2) 귀무 가설(H0): 코로나19 환자의 수축기 혈압은 알려진 국가 통계와 동일하다.

# 검정 통계량은 이전의 [Step 1]에서 계산한 값과 동일하게 사용됩니다.

# (4) p-value: 0.0003674451

# (5) 5% 유의 수준에서의 의사결정

# p-value가 유의 수준 0.05보다 작으므로, 귀무 가설을 기각하고 대립 가설을 선택합니다. 이는 '코로나19 환자의 수축기 혈압은 알려진 국가 통계보다 통계적으로 유의미하게 높다'는 결론을 내리게 됩니다.

# 즉, 이 결과는 코로나19 환자의 수축기 혈압이 알려진 국가 통계보다 높다는 것을 의미합니다. 이는 귀무 가설을 기각하였기 때문에, 코로나19 환자의 수축기 혈압이 알려진 국가 통계보다 통계적으로 유의미한 차이가 있다는 점을 기반으로 합니다.

# 따라서, 통계적으로 깔끔하게 올바른 결론은 '코로나19 환자의 수축기 혈압은 알려진 국가 통계보다 높다'라고 할 수 있습니다. 이는 5%의 유의 수준에서 귀무 가설을 기각하고 대립 가설을 선택한 결과입니다.

##################################
## 확률과 통계 과제             ##
## 고려대학교                   ##
## 서민석                       ##
## 2021270678 나강민 질문3      ##
##################################

# 남성의 데이터 분리
data_male <- subset(data, Gender == "1")  

# z-test 수행
mu0 <- 74.62  # 국립보건원에서 정한 남성의 심박수 평균
sigma <- sqrt(11.1)  # 국립보건원에서 정한 남성의 심박수 표준편차 (분산의 제곱근을 취해줍니다.)
n <- nrow(data_male)  # 남성의 수
xbar <- mean(data_male$HR)  # 남성들의 심박수 평균
se <- sigma / sqrt(n)  # 표준 오차
z <- (xbar - mu0) / se  # 검정 통계량 계산

# p-value 계산
p_value_higher <- pnorm(-z)  # "남성의 심박수가 평균보다 높다"를 검정
p_value_lower <- pnorm(z)  # "남성의 심박수가 평균보다 낮다"를 검정
p_value_different <- 2 * pnorm(-abs(z))  # "남성의 심박수가 평균과 다르다"를 검정

# 결과 출력
cat("검정 통계량:", z, "
")
cat("p-value (higher):", p_value_higher, "
")
cat("p-value (lower):", p_value_lower, "
")
cat("p-value (different):", p_value_different, "
")

# 5% 유의 수준에서 의사결정
if (p_value_higher < 0.05) {
  cat("5%의 유의 수준에서, '남성의 심박수가 평균보다 높다'는 가설을 지지합니다.
")
} 
if (p_value_lower < 0.05) {
  cat("5%의 유의 수준에서, '남성의 심박수가 평균보다 낮다'는 가설을 지지합니다.
")
} 
if (p_value_different < 0.05) {
  cat("5%의 유의 수준에서, '남성의 심박수가 평균과 다르다'는 가설을 지지합니다.
")
}

############ 해당 코드 설명 ###################

# 검정 통계량은 약 1.68입니다. 이는 샘플 평균이 모집단 평균과 얼마나 다른지를 표준 오차 단위로 표현한 것입니다. 이 값이 크면 클수록 샘플 평균이 모집단 평균과 더 크게 다르다는 것을 의미합니다.
# '남성의 심박수가 평균보다 높다'는 가설에 대한 p-value는 약 0.047입니다. 이는 5%의 유의 수준에서 귀무 가설을 기각하고 이 가설을 지지하게 만드는 값입니다. 즉, 샘플 데이터를 바탕으로 남성의 심박수가 국립보건원에서 제시한 평균보다 통계적으로 유의미하게 높다고 할 수 있습니다.
# '남성의 심박수가 평균보다 낮다'는 가설에 대한 p-value는 약 0.953입니다. 이는 5%의 유의 수준에서 귀무 가설을 기각할 수 없으므로, 이 가설을 지지할 수 없습니다. 즉, 샘플 데이터를 바탕으로 남성의 심박수가 국립보건원에서 제시한 평균보다 통계적으로 유의미하게 낮다고 할 수 없습니다.
# '남성의 심박수가 평균과 다르다'는 가설에 대한 p-value는 약 0.093입니다. 이는 5%의 유의 수준에서 귀무 가설을 기각할 수 없으므로, 이 가설을 지지할 수 없습니다. 즉, 샘플 데이터를 바탕으로 남성의 심박수가 국립보건원에서 제시한 평균과 통계적으로 유의미하게 다르다고 할 수 없습니다.
# 따라서, 이 분석을 통해 '남성의 심박수가 국립보건원에서 제시한 평균보다 높다'는 가설을 지지할 수 있습니다. 다시 말해, 샘플 데이터를 바탕으로 남성의 심박수가 국립보건원에서 제시한 평균보다 통계적으로 유의미하게 높다고 결론 내릴 수 있습니다.


##################################
## 확률과 통계 과제             ##
## 고려대학교                   ##
## 서민석                       ##
## 2021270678 나강민 질문4      ##
##################################

# 남성의 데이터 분리
data_male <- subset(data, Gender == "1")  

# z-test 수행
mu0 <- 74.62  # 국립보건원에서 정한 남성의 심박수 평균
sigma <- sqrt(11.1)  # 국립보건원에서 정한 남성의 심박수 표준편차 (분산의 제곱근을 취해줍니다.)
n <- nrow(data_male)  # 남성의 수
xbar <- mean(data_male$HR)  # 남성들의 심박수 평균
se <- sigma / sqrt(n)  # 표준 오차
z <- (xbar - mu0) / se  # 검정 통계량 계산

# p-value 계산
p_value_higher <- pnorm(-z)  # "남성의 심박수가 평균보다 높다"를 검정
p_value_lower <- pnorm(z)  # "남성의 심박수가 평균보다 낮다"를 검정
p_value_different <- 2 * pnorm(-abs(z))  # "남성의 심박수가 평균과 다르다"를 검정

# 결과 출력
cat("검정 통계량:", z, "
")
cat("p-value (higher):", p_value_higher, "
")
cat("p-value (lower):", p_value_lower, "
")
cat("p-value (different):", p_value_different, "
")

# 10% 유의 수준에서 의사결정
if (p_value_higher < 0.10) {
  cat("10%의 유의 수준에서, '남성의 심박수가 평균보다 높다'는 가설을 지지합니다.
")
} 
if (p_value_lower < 0.10) {
  cat("10%의 유의 수준에서, '남성의 심박수가 평균보다 낮다'는 가설을 지지합니다.
")
} 
if (p_value_different < 0.10) {
  cat("10%의 유의 수준에서, '남성의 심박수가 평균과 다르다'는 가설을 지지합니다.
")
}

############ 해당 코드 설명 ###################

# 유의 수준을 5%에서 10%로 높였을 때, 가설 검정의 결과는 어떻게 바뀌는지 살펴보겠습니다:

# '남성의 심박수가 평균보다 높다'는 가설은 5%의 유의 수준에서도 지지되었으므로, 10%에서도 지지됩니다.
# '남성의 심박수가 평균보다 낮다'는 가설은 5%와 10%의 유의 수준에서 모두 지지되지 않습니다.
# '남성의 심박수가 평균과 다르다'는 가설은 5%의 유의 수준에서는 지지되지 않았지만, 10%의 유의 수준에서는 지지됩니다.
# 이로부터 우리는 두 가지 주요한 점을 배울 수 있습니다:

# 유의 수준을 높이면 귀무 가설을 기각하기 쉬워집니다. 이는 유의 수준이 우리가 귀무 가설을 잘못 기각하는 오류를 감수할 확률을 결정하기 때문입니다. 유의 수준을 높일수록 이런 오류를 더 많이 감수하게 되므로, 귀무 가설을 기각하기 쉬워집니다.
# 가설 검정의 결과는 사용하는 유의 수준에 따라 달라질 수 있습니다. 따라서, 가설 검정을 수행할 때는 사용하는 유의 수준을 항상 명시해야 합니다.
# 이에 따라, 통계적 가설 검정은 단순히 p-value가 0.05보다 작은지를 보는 것만으로는 충분하지 않습니다. 분석의 목적과 문맥, 그리고 우리가 감수할 수 있는 오류의 정도를 고려하여 적절한 유의 수준을 선택해야 합니다.


##################################
## 확률과 통계 과제             ##
## 고려대학교                   ##
## 서민석                       ##
## 2021270678 나강민 질문5      ##
##################################

# z-test 수행
mu0 <- 96.0245  # 국민건강보험에서 조사한 휴식 SaO2 평균
sigma <- 8.995  # 국민건강보험에서 조사한 휴식 SaO2 표준편차
n <- nrow(data)  # 개체의 수
xbar <- mean(data$Resting_SaO2)  # 현재 로드된 데이터의 휴식 SaO2 평균
se <- sigma / sqrt(n)  # 표준 오차
z <- (xbar - mu0) / se  # 검정 통계량 계산

# p-value 계산
p_value <- 2 * pnorm(-abs(z))  # 귀무 가설과 대립 가설이 모두 '평균과 같다/다르다'로 설정되었으므로, 양측 검정을 수행합니다.

# 결과 출력
cat("검정 통계량:", z, "
")
cat("p-value:", p_value, "
")

# 5% 유의 수준에서 의사결정
if (p_value < 0.05) {
  cat("5%의 유의 수준에서, 귀무 가설을 기각하고 대립 가설을 선택합니다. 즉, 현재 로드된 데이터의 휴식 SaO2 평균이 국민건강보험에서 조사한 평균과 통계적으로 유의미하게 다릅니다.
")
} else {
  cat("5%의 유의 수준에서, 귀무 가설을 기각하지 않습니다. 즉, 현재 로드된 데이터의 휴식 SaO2 평균이 국민건강보험에서 조사한 평균과 통계적으로 유의미한 차이가 없습니다.
")
}

############ 해당 코드 설명 ###################

# 분석 결과에 따르면, 검정 통계량은 약 0.44이고 p-value는 약 0.66입니다. 여기서 유의 수준은 5%로 설정하였습니다.
# p-value가 유의 수준 0.05보다 크므로, 귀무 가설을 기각하지 않습니다. 이는 '현재 로드된 데이터의 휴식 SaO2 평균이 국민건강보험에서 조사한 평균과 통계적으로 유의미한 차이가 없다'는 결론을 내리게 됩니다.
# 즉, 이 결과는 현재 로드된 데이터의 휴식 SaO2 평균이 국민건강보험에서 조사한 평균과 크게 다르지 않다는 것을 의미합니다. 다시 말해, 현재 로드된 데이터는 휴식 SaO2 측면에서 국민건강보험에서 조사한 한국인 개체군을 잘 대표하고 있다고 볼 수 있습니다.
# 그러므로, 통계적으로 깔끔하게 올바른 결론은 '현재 로드된 데이터는 휴식 SaO2 측면에서 국민건강보험에서 조사한 한국인 개체군을 대표하는 독립적인 개체군이다'라고 할 수 있습니다. 이는 귀무 가설을 기각하지 않았기 때문에, 데이터가 국민건강보험에서 조사한 값과 통계적으로 유의미한 차이가 없다는 점을 기반으로 합니다.

