##################################
## 확률과 통계 과제             ##
## 고려대학교                   ##
## 서민석                       ##
## 2021270678 나강민 질문2      ##
##################################

## 라이브러리 및 저장소 설정
setRepositories(ind = 1:7)

# 패키지 설치
# install.packages("BSDA")

## 라이브러리 불러오기
library(devtools)
library(BSDA)

# 데이터 불러오기
data <- read.table("/Users/mac_nkm/Documents/GitHub/Probability_Statistics_KUS/HomeWork2/Data.txt", header = TRUE, sep = "\t", stringsAsFactors = FALSE) 

# 코로나에 걸린 사람의 데이터 분리
data_infected <- subset(data, Disease == "COVID19") 

# z-test 수행
mu0 <- 128.65  # 국립보건원에서 정한 정상인의 수축기 혈압 평균
sigma <- 16.5  # 국립보건원에서 정한 정상인의 수축기 혈압 표준편차
n <- nrow(data_infected)  # 코로나에 걸린 사람의 수
xbar <- mean(data_infected$sysBP)  # 코로나에 걸린 사람들의 수축기 혈압 평균
se <- sigma / sqrt(n)  # 표준 오차
z <- (xbar - mu0) / se  # 검정 통계량 계산

# p-value 계산
p_value <- pnorm(-abs(z))  # 단측 검정을 수행하므로, pnorm 함수에 -abs(z)를 넣습니다.

# 결과 출력
cat("검정 통계량:", z, "
")
cat("p-value:", p_value, "
")

# 5% 유의 수준에서 의사결정
if (p_value < 0.05) {
  cat("5%의 유의 수준에서, 귀무 가설을 기각하고 대립 가설을 선택합니다. 즉, 코로나에 걸린 사람들의 수축기 혈압이 정상인의 혈압보다 통계적으로 유의미하게 높습니다.
")
} else {
  cat("5%의 유의 수준에서, 귀무 가설을 기각하지 않습니다. 즉, 코로나에 걸린 사람들의 수축기 혈압이 정상인의 혈압보다 통계적으로 유의미하게 높다고 할 수 없습니다.
")
}

############ 해당 코드 설명 ###################


# 이 문제에서는 코로나19 환자가 알려진 국가 통계보다 높은 수축기 혈압을 보이는지에 대해 통계적으로 검정하려고 합니다. 5% 유의 수준에서 이를 검증해봅시다.

# (1) 대립 가설(H1): 코로나19 환자의 수축기 혈압은 알려진 국가 통계보다 높다.

# (2) 귀무 가설(H0): 코로나19 환자의 수축기 혈압은 알려진 국가 통계와 동일하다.

# 검정 통계량은 이전의 [Step 1]에서 계산한 값과 동일하게 사용됩니다.

# (4) p-value: 0.0003674451

# (5) 5% 유의 수준에서의 의사결정

# p-value가 유의 수준 0.05보다 작으므로, 귀무 가설을 기각하고 대립 가설을 선택합니다. 이는 '코로나19 환자의 수축기 혈압은 알려진 국가 통계보다 통계적으로 유의미하게 높다'는 결론을 내리게 됩니다.

# 즉, 이 결과는 코로나19 환자의 수축기 혈압이 알려진 국가 통계보다 높다는 것을 의미합니다. 이는 귀무 가설을 기각하였기 때문에, 코로나19 환자의 수축기 혈압이 알려진 국가 통계보다 통계적으로 유의미한 차이가 있다는 점을 기반으로 합니다.

# 따라서, 통계적으로 깔끔하게 올바른 결론은 '코로나19 환자의 수축기 혈압은 알려진 국가 통계보다 높다'라고 할 수 있습니다. 이는 5%의 유의 수준에서 귀무 가설을 기각하고 대립 가설을 선택한 결과입니다.